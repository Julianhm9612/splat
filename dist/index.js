import{draw3DHand,moveHands,initRenderer,initLights,render,updateStartButton,initTrailOptions,loadPoseNet,initSounds,guiState,generateFruits,loadFruitsModels,onWindowResize,initSceneGeometry,initScene,initTrailRenderers,isMobile,losePoint}from"./utils.js";const hands=[];let handMesh,scoreDivContent=document.getElementsByClassName("score-number")[0],canvas=document.getElementById("output");const flipHorizontal=!1;canvas.width=window.innerWidth,canvas.height=window.innerHeight,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.onload=async()=>{if(isMobile()){const a=document.getElementsByClassName("intro")[0];a.style.display="none";const b=document.getElementsByClassName("mobile-intro")[0];return void(b.style.display="block")}initSounds(),lastTrailUpdateTime=performance.now(),lastTrailResetTime=performance.now(),await loadPoseNet(),video&&detectPoseInRealTime(video),initScene(),initRenderer(),initTrailOptions(),initLights(),loadFruitsModels(),initSceneGeometry(function(){initTrailRenderers(),updateStartButton()})};const detectPoseInRealTime=async a=>{async function b(){const c=guiState.input.imageScaleFactor,d=+guiState.input.outputStride;let e,f,g=[];switch(guiState.algorithm){case"single-pose":const b=await guiState.net.estimateSinglePose(a,c,flipHorizontal,d);g.push(b),e=+guiState.singlePoseDetection.minPoseConfidence,f=+guiState.singlePoseDetection.minPartConfidence;}g.forEach(({score:a,keypoints:b})=>{if(a>=e&&guiState.output.showPoints){const a=b.find(a=>"leftWrist"===a.part),c=b.find(a=>"rightWrist"===a.part);0===hands.length?(c||a)&&(handMesh=draw3DHand(),hands.push({mesh:handMesh,coordinates:c?c.position:a.position,name:c?"rightHand":"leftHand"}),scene.add(handMesh)):hands[0].coordinates="rightHand"===hands[0].name?c.position:a.position}}),requestAnimationFrame(b)}b()},animate=()=>{frameLoop=requestAnimationFrame(animate);var a=performance.now();if(trailTarget&&updateTrailTarget(a),fruitsObjects&&fruitsObjects.map(a=>{a.rotation.x+=.1,a.rotation.y+=.1,"up"===a.direction&&(a.position.y+=a.speed),a.position.y>a.thresholdBottomY&&!a.soundPlayed&&"up"===a.direction&&("bomb"===a.name?bombSlicedSound.play():newFruitSound.play(),a.soundPlayed=!0),a.position.y>a.thresholdTopY&&(a.direction="down"),"down"===a.direction&&(a.position.y-=a.speed),a.position.y<a.thresholdBottomY&&"down"===a.direction&&(scene.remove(a),fruitsObjects.splice(a.index,1),"bomb"!==a.name&&losePoint(),!gameOver&&generateFruits(1))}// generate new fruit?
),hands.length){let a=moveHands(hands,camera,fruitsObjects);a.includes(!0)&&(score+=1,scoreDivContent.innerHTML=score,fruitSliced.play())}render()};window.addEventListener("resize",onWindowResize,!1),document.getElementsByTagName("button")[0].onclick=()=>{document.getElementsByClassName("intro")[0].style.display="none",document.getElementsByClassName("score")[0].style.display="block",scene.add(trailTarget),animate()};const updateTrailTarget=function(){var a=new THREE.Matrix4,b=new THREE.Matrix4;return function(c){10<c-lastTrailUpdateTime?(trail.advance(),lastTrailUpdateTime=c):trail.updateHead(),a.identity(),b.identity()}}();